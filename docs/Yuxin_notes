Yuxin\s notes


====================================================== Git Repo ======================================================
-Lucio started the repo and invided me, we will have 3 different branch there, I ren amed it team 
-I have a remote link repo origin 
- then at team repo, I git remote add origin https://github.com/Yuxin29/Webserver.git 
- I will work in shared team repo, and git push origin my_branch / main normally there 
- to update it to my personal redo, I do git push -u origin my_branch / main there 
- when project is over, I WILL git remote remove team

====================================================== Teamwork flow ======================================================
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚     Client         â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚  HTTP request
                           â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚       A: Network & I/O Manager    â”‚
             â”‚---------------------------------- â”‚
             â”‚ - Accepts connections             â”‚
             â”‚ - poll/select/epoll monitors FDs  â”‚
             â”‚ - Non-blocking read/write         â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ raw bytes
                         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   B: HTTP Request/Response Handler  â”‚
            â”‚-------------------------------------â”‚
            â”‚ - Parse HTTP request                â”‚
            â”‚ - Apply HTTP rules                  â”‚
            â”‚ - Determines action (static/CGI/etc)â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚               â”‚
           asks for config rules   needs CGI process
                       â”‚               â”‚
                       â–¼               â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚        C: Configuration & CGI Manager        â”‚
     â”‚----------------------------------------------â”‚
     â”‚ - server.conf parser                         â”‚
     â”‚ - location/root/index/error_pages            â”‚
     â”‚ - CGI execution (execve)                     â”‚
     â”‚ - file path resolution                       â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ response data (file/CGI output)
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚    B builds full HTTP response      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ final bytes
                               â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚    A: Sends response to client     â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

====================================================== Lin sent from wahtsapp ======================================================
A|Network & I/O Manager |- Set up listening sockets		
-Handle poll() / select() / epoll()
-Manage client connections and file descriptors | - Implement non-blocking I/O logic
-Manage read/write events
-Prevent blocking to ensure responsiveness | - Optimize performance under heavy load
-Handle signals and interruptions
Conduct stress tests (e.g., with ab, wrk) |

B | HTTP Request/Response Handler | - Implement HTTP request parser (start-line, headers, body)
-Build HTTP response generator (status line, headers, body)
-Handle basic GET requests | - Add support for POST and DELETE
-Ensure HTTP/1.1 compliance
-Implement proper status codes and headers | - Fine-tune keep-alive behavior
-Match browser and NGINX behavior
-(Optional??) Handle chunked transfer encoding |

C | Configuration & CGI Manager | - Design and implement server.conf parser
-Support directives: server, location, listen, root, index, etc. | - Implement CGI execution (e.g., via execve)
-Add file upload support
-Route requests and handle custom error pages | - Add bonus features: autoindex, redirects
-Prepare demo config files for defense
-Polish docs, error handling, testing scripts |

====================================================== HTTP form ======================================================
type of http request:
GET     POST    PUT         PATCH           DELETE  HEAD                            OPTIONS         CONNECT         TRACE
read    create  replace     partial update  delete  like get, but not return body   check methods   build router    for testing
requred by suj: GET, POST, and DELETE

----> a normal http request form
<start-line>\r\n
<header1: value>\r\n
<header2: value>\r\n
...\r\n
\r\n
<body>
------
1. <start-line>\r\n
Method sp _path sp version crlf(Carriage Return and Line Feed)
Get /index.html HTTP/1.1\r\n
------
2. <header1: value>\r\n
Host: example.com\r\n                â† Headers
User-Agent: curl/7.64.1\r\n
Content-Length: 5\r\n
------
3. empty line
\r\n 
------
4. Body, only for POST, PUT
hello 

----> a normal http response form
<status-line>\r\n
<header1: value>\r\n
...\r\n
\r\n
<body>
------
1.<status-line>\r\n
VERSION SP STATUS_CODE SP REASON_PHRASE CRLF
HTTP/1.1 200 OK\r\needs
2.<headern: value>\r\n
Content-Type: text/html\r\n
Content-Length: 13\r\n
3. empty line
\r\need
4. body:
a string: like "hello world"

====================================================== MAP container that stores keyâ€“value pairs ======================================================
#include <map>
--> std::map
- ordered assoiative container
- automateically keeps the keys sorted
- each key must be unique
- Lookup, insertion and deletion are all O(log n)
For example
std::map<std::string, std::string> headers; 
headers["Host"] = "localhost:8080";
headers["User-Agent"] = "curl/7.68.0";
headers["Accept"] = "*/*";
headers["Content-Length"] = "12";

====================================================== MAP container that stores keyâ€“value pairs ======================================================
ğŸ—“ ç¬¬ 1 å‘¨ â€” HTTP è¯·æ±‚è§£æåŸºç¡€
ç¬¬ 1 å¤© â€” å­¦åŸºç¡€ + å»ºç«‹ç»“æ„
å­¦ä¹ ï¼šHTTP/1.1 æ ¼å¼, è¯·æ±‚è¡Œï¼ˆæ–¹æ³•ã€è·¯å¾„ã€ç‰ˆæœ¬, Header è§„åˆ™, CRLF
å®ç°ï¼šåˆ›å»º HttpRequest / HttpParser / HttpResponse æ¡†æ¶
æµ‹è¯•ï¼š æ— 

ç¬¬ 2 å¤© â€” è§£æè¯·æ±‚è¡Œ
å­¦ä¹ ï¼šGET/POST/DELETE, URL ç®€å•å¤„ç†
å®ç°ï¼šparseRequestLine()
æµ‹è¯•ï¼šprintf "GET / HTTP/1.1\r\n\r\n" | nc localhost 8080

ç¬¬ 3 å¤© â€” è§£æ Headers
å­¦ä¹ ï¼š key:value æ ¼å¼. ä¸åŒºåˆ†å¤§å°å†™
å®ç°ï¼šparseHeaders() â†’ å­˜å…¥ map
æµ‹è¯•ï¼šé‡å¤å­—æ®µ, ç¼ºå°‘ CRLF

ç¬¬ 4 å¤© â€” åŸºç¡€ bodyï¼ˆContent-Lengthï¼‰
å®ç°ï¼šæŒ‰ Content-Length è¯» body
æµ‹è¯•ï¼šcurl -d "hello" http://localhost:8080

ç¬¬ 5 å¤© â€” çŠ¶æ€æœºè§£æï¼ˆéé˜»å¡å¿…éœ€ï¼‰
å­¦ä¹ ï¼šSTART_LINE â†’ HEADERS â†’ BODY â†’ DONE
å®ç°ï¼šHttpParser::consume(buffer)
æµ‹è¯•ï¼šåˆ†åŒ…è§£æ, æ¨¡æ‹Ÿæ…¢é€Ÿæ”»å‡»ï¼ˆslowlorisï¼‰

ğŸ—“ ç¬¬ 2 å‘¨ â€” å“åº”ç”Ÿæˆ + å„ç§æ–¹æ³•
ç¬¬ 6 å¤© â€” Response åŸºç¡€
å®ç°ï¼šstatus line, header set
æµ‹è¯•ï¼šä¸ nginx å¯¹æ¯”

ç¬¬ 7 å¤© â€” å®ç° GETï¼ˆé™æ€æ–‡ä»¶ï¼‰
å­¦ä¹ ï¼šMIME types, æ–‡ä»¶æƒé™
æµ‹è¯•ï¼šcurl -v http://localhost:8080/file.txt

ç¬¬ 8 å¤© â€” å®ç° POST
å®ç°ï¼šä¿å­˜ body, è¿”å› 200/201
æµ‹è¯•ï¼šcurl -X POST -d "x=y" http://localhost:8080

ç¬¬ 9 å¤© â€” å®ç° DELETE
å®ç°ï¼šåˆ é™¤æ–‡ä»¶ + æƒé™æ£€æŸ¥
æµ‹è¯•ï¼šcurl -X DELETE http://localhost:8080/a.txt

ç¬¬ 10 å¤© â€” é”™è¯¯é¡µé¢ + éªŒè¯
å®ç°ï¼š400 / 413 / 414 / 500, è‡ªåŠ¨ç”Ÿæˆé”™è¯¯è¿”å›
æµ‹è¯•ï¼šéæ³•è¯·æ±‚, è¶…é•¿ URL, body è¶…å¤§

ğŸ—“ ç¬¬ 3 å‘¨ â€” Keep-aliveã€æµè§ˆå™¨è¡Œä¸ºã€å‹åŠ›æµ‹è¯•
ç¬¬ 11 å¤© â€” Keep-Alive
å­¦ä¹ ï¼šConnection: close, HTTP/1.0 è¡Œä¸ºå·®å¼‚
å®ç°ï¼šshouldCloseConnection()
æµ‹è¯•ï¼š curl / Chrome

ç¬¬ 12 å¤© â€” å¯¹é½ NGINX è¡Œä¸º
å­¦ä¹ ï¼š Host ç¼ºå¤±, å¤šä½™ç©ºæ ¼, é‡å¤ headers
æµ‹è¯•ï¼šä¸ nginx å¯¹æ¯”è¾“å‡º

ç¬¬ 13 å¤© â€” Chunkedï¼ˆå¯é€‰ï¼‰
å®ç°ï¼šè§£æ chunked, æˆ–ç”Ÿæˆ chunked
æµ‹è¯•ï¼š curl -H "Transfer-Encoding: chunked" -d "test" localhost:8080

ç¬¬ 14 å¤© â€” å‹åŠ›æµ‹è¯•
æµ‹è¯•å·¥å…·ï¼šab, wrk
å‘½ä»¤ï¼š
ab -n 5000 -c 100 http://localhost:8080/
wrk -t4 -c200 -d10s http://localhost:8080/
ä¿®å¤ï¼šå†…å­˜æ³„æ¼, å‡æ­», keep-alive å¾ªç¯

ç¬¬ 15 å¤© â€” æœ€ç»ˆæ•´ç† + å®Œæ•´æµ‹è¯•
æµ‹è¯•ï¼šæµè§ˆå™¨, curl, RFC å®¡æŸ¥
æ¸…ç†ï¼šç§»é™¤ debug, æ³¨é‡Šã€ä»£ç è§„èŒƒåŒ– 